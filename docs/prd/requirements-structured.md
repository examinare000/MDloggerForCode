# MDloggerForCode 要件定義書

## 1. プロジェクト概要

**プロダクト名**: MDloggerForCode  
**目的**: VS Code上でObsidianの基本機能を提供する拡張機能  
**対象環境**: VS Code Desktop（Windows/Mac/Linux、Remote/WSL/Dev Containers対応）

## 2. 機能要件

### 2.1 MVP機能

#### 2.1.1 Wikiリンク機能 ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F001 | Wikiリンク認識 | `[[...]]` 形式をリンクとして認識・表示 | 高 |
| F002 | リンクナビゲーション | クリック/Ctrl+Enterでファイルジャンプ | 高 |
| F003 | 未存在ファイル作成 | 存在しないリンクから自動でファイル作成 | 高 |
| F004 | 別名リンク対応 | `[[Page\|表示名]]` 形式の解釈 | 中 |
| F005 | 見出しリンク対応 | `[[Page#Heading]]` 形式の解釈 | 中 |
| F006 | コンテキスト制御 | Wikiリンク内でのみキーバインド有効化 | 高 |
| F007 | 補完（プレフィックス検索） | `[[` で補完トリガー、ファイル名プレフィックス検索 | 高 |
| F008 | 補完（ディレクトリ指定） | `/` を含むパス指定でディレクトリ内を絞り込み | 中 |
| F009 | サブディレクトリ探索 | 既存ノートをサブディレクトリから優先解決 | 中 |

#### 2.1.2 Markdownプレビュー機能 ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F010 | 基本Markdown描画 | 太字、チェックリスト、標準リンクの描画 | 高 |
| F011 | Wikiリンク描画 | `[[...]]` リンクをプレビューに表示 | 高 |
| F012 | プレビュー→エディタ連携 | プレビューからエディタ位置へジャンプ | 中 |
| F013 | 軽量実装 | 複雑な描画は行わず軽量に実装 | 高 |

#### 2.1.3 日時挿入機能 ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F014 | 日付挿入 | Alt+D でカーソル位置に日付挿入 | 中 |
| F015 | 時刻挿入 | Alt+T でカーソル位置に時刻挿入 | 中 |
| F016 | フォーマット設定 | 日付・時刻フォーマットの設定可能 | 低 |

#### 2.1.4 DailyNote 機能 ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F017 | DailyNote生成/オープン | `mdlg.openDailyNote` で日次ノートを生成し開く | 高 |
| F018 | ファイル名/格納先設定 | `mdlg.dailyNotePath` / `mdlg.dailyNoteFormat` で配置と命名を制御 | 中 |
| F019 | テンプレート適用 | `mdlg.dailyNoteTemplate` に従い初期内容を生成 | 中 |
| F020 | 無効化サポート | `mdlg.dailyNoteEnabled` で機能の有効/無効を切替 | 低 |

#### 2.1.5 クイックキャプチャ ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F021 | 1行キャプチャ追記 | Quick Capture ビューから DailyNote に 1 行追記 | 高 |
| F022 | 追記セクション指定 | `mdlg.captureSectionName` で追記先見出しを指定 | 中 |
| F023 | タスク一覧/完了 | DailyNote 配下の未完了タスク一覧と完了更新 | 中 |
| F024 | 日次ノート依存制御 | DailyNote 無効時は Quick Capture を登録しない | 中 |

#### 2.1.6 リスト継続入力 ??
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F025 | 箇条書き継続 | Enter で箇条書き/番号/チェックボックスを継続 | 中 |
| F026 | 空項目削除 | 空リスト行で Enter 時に行を削除 | 中 |
| F027 | 無効化設定 | `mdlg.listContinuationEnabled` で有効/無効切替 | 低 |

### 2.2 設定機能
| 要件ID | 設定項目 | デフォルト値 | 説明 |
|--------|----------|--------------|------|
| F028 | mdlg.vaultRoot | ワークスペースルート | Vaultのルートディレクトリ |
| F029 | mdlg.noteExtension | .md | ノートファイルの拡張子 |
| F030 | mdlg.slugStrategy | passthrough | ファイル名変換方式 |
| F031 | mdlg.dateFormat | YYYY-MM-DD | 日付挿入フォーマット |
| F032 | mdlg.timeFormat | HH:mm | 時刻挿入フォーマット |
| F033 | mdlg.template | 空文字 | 新規ノートテンプレート |
| F034 | mdlg.dailyNoteEnabled | true | DailyNote機能の有効/無効 |
| F035 | mdlg.dailyNotePath | dailynotes | DailyNoteの格納先ディレクトリ |
| F036 | mdlg.dailyNoteFormat | YYYY-MM-DD.md | DailyNoteファイル名フォーマット |
| F037 | mdlg.dailyNoteTemplate | 空文字 | DailyNoteテンプレート |
| F038 | mdlg.captureSectionName | Quick Notes | Quick Capture 追記先見出し |
| F039 | mdlg.listContinuationEnabled | true | リスト継続入力の有効/無効 |
| F040 | mdlg.searchSubdirectories | true | WikiLink 解決時のサブディレクトリ探索可否 |

## 3. 技術要件

### 3.1 アーキテクチャ要件
| 要件ID | 項目 | 技術選択 | 理由 |
|--------|------|----------|------|
| T001 | 拡張機能フレームワーク | VS Code Extension API | 対象プラットフォーム |
| T002 | ファイル操作 | workspace.fs | Remote環境対応 |
| T003 | Markdownパーサー | markdown-it + wikilinks plugin | 拡張性・軽量性 |
| T004 | プレビュー表示 | VS Code Webview API | セキュリティ・統合性 |

### 3.2 実装要件
| 要件ID | コンポーネント | 実装方式 | 詳細 |
|--------|----------------|----------|------|
| T005 | DocumentLinkProvider | VS Code API | `[[...]]` のリンク化 |
| T006 | コマンド登録 | package.json contributes | 各種コマンドの定義 |
| T007 | キーバインド | when句使用 | コンテキスト制御 |
| T008 | 設定管理 | VS Code Configuration | 設定値の永続化 |

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **起動時間**: 拡張機能アクティベーション < 500ms
- **リンク解析**: 大きなファイル（>1MB）でも遅延なし
- **プレビュー描画**: < 100ms
- **ファイル作成・移動**: 体感的に瞬時

### 4.2 互換性要件
- **プラットフォーム**: Windows 10+、macOS 10.15+、Linux（主要ディストリビューション）
- **VS Code**: 最新版 + 過去2メジャーバージョン
- **Remote環境**: WSL、SSH Remote、Dev Containers

### 4.3 ユーザビリティ要件
- **学習コスト**: Obsidianユーザーが迷わず使用可能
- **操作性**: キーボードショートカットでの高速操作
- **フィードバック**: 操作結果の明確な視覚的フィードバック

## 5. 受け入れ基準（DoD）

### 5.1 機能テスト
- [ ] **Wikiリンク (F001-F009)**: 認識・ナビゲーション・補完・サブディレクトリ解決
  - [ ] `[[New Note]]` でCtrl/Cmd+Enterによりファイル作成・エディタ表示
  - [ ] 既存 `[[Existing]]` でクリック/Ctrl/Cmd+Enterによりジャンプ
  - [ ] `[[Page|表示名]]`、`[[Page#Heading]]` の正常解決
  - [ ] `[[` と `/` 入力で補完が発火し、ディレクトリ指定とサブディレクトリ探索が機能
  
- [ ] **プレビュー (F010-F013)**: 太字・チェックリスト・標準リンク・Wikiリンクの描画とエディタ連携
  
- [ ] **日時挿入 (F014-F016)**: Alt+D/Alt+T で設定フォーマット通りに挿入
  
- [ ] **DailyNote (F017-F020)**:
  - [ ] `mdlg.openDailyNote` でフォーマット/パス/テンプレート設定通りに生成・オープン
  - [ ] 無効化設定時は登録・実行されないこと

- [ ] **Quick Capture (F021-F024)**:
  - [ ] Quick Capture ビューから 1 行追記が指定セクションに追加される
  - [ ] 未完了タスク一覧の取得と完了更新が DailyNote に反映される
  - [ ] DailyNote 無効時はビュー/コマンドが登録されない

- [ ] **リスト継続 (F025-F027)**:
  - [ ] 箇条書き/番号/チェックボックスで Enter により継続される
  - [ ] 空項目で Enter を押すと行が削除される
  - [ ] 無効化設定時は通常の Enter 挙動に戻る

### 5.2 環境テスト
- [ ] **ローカル環境**: Windows/Mac/Linuxでの動作確認
- [ ] **Remote環境**: WSL、SSH Remote、Dev Containersでの動作確認

### 5.3 パフォーマンステスト
- [ ] 大きなファイル（1MB+）での操作遅延なし
- [ ] プレビュー描画速度 < 100ms

## 6. 将来拡張（非MVP）

### 6.1 除外機能
以下は現行バージョンでは実装しない：
- グラフ表示
- Obsidian プラグイン互換性
- モバイル同期
- VS Code Web版対応

### 6.2 将来検討事項
- 高度なMarkdown描画
- テーマ対応
- パフォーマンス/索引最適化（キャッシュ等）

---

**文書バージョン**: 1.1  
**最終更新**: 2025-11-19  
**承認者**: [承認者名]
